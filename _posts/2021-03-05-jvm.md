---
layout: post
title: JVM
description: 都说世界上没有最好的编程语言，我认为java就是
category: blog
---

[热门语言排行](https://www.tiobe.com/tiobe-index/)

重大事件：  
* 1995年5月23日，Java语言诞生；
* 1998年2月，JDK1.1被下载20,000,000次。
   
[jvm文档-jdk8](https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-1.html#jvms-1.2)  

[类加载](https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-5.html)

转换.class文件利于阅读:java -p -v \输入.class > 输出.txt

类加载:把类加载到jvm中去,如果jvm想要把数据加载进来,那么jvm一定是把数据加载到内存中,那么想要访问这些数据肯定需要一个访问入口或媒介,才能从内存中拿到数据,而数据肯定是从.class文件中获得中获得的,毋庸置疑,数据访问的入口肯定是一个对象,因为java是面向对象的

![1](/images/jvm/1-1.png)  

而其被称作虚拟机,必定与物理计算机数据加载过程一致.

![2](/images/jvm/1-2.png)

类加载过程:  
![3](/images/jvm/1-3.png)  

![4](/images/jvm/1-4.png) 

**装载**:将数据放入内存,将字节流代表的静态储存结构放入方法区,变成一个运行储存结构,因为要run起来了.  
同时在内存当中生成数据访问入口(生成class对象代表数据访问入口).   
实际上在装载阶段完成之后,方法区里面就有类信息/静态变量/常量了,但是即使编译过后的热点代码不在这个阶段进入方法区.包括堆中只有代表这个类的一个Class对象.  
装载阶段:最重要的一步,只能在这个阶段才能对它进行操控.  
1.对类加载器进行操作  
2.自定义类加载器操作/做字节码增强操作(Javaagent)  

**链接**:  
   1.验证:1验证字节码文件必须符合要求,2不能危害虚拟机的安全  
      + 文件格式验证:主要目的是保证输入的字节流能够正确的解析并储存在方法区之内(所以发生在进入方法区之前).
         + 如是否以16进制的cafebaby开头
         + 版本号是否正确
      + 元数据验证:进行语义校验,java语法等,不符合规范的不能进入方法区,或者进去了要识别出来
         + 是否有父类
         + 是否继承了final类,继承类抽象类,没实现抽象方法等
      + 字节码验证:校验对虚拟机的安全危害,并不一定语法错误
         + 运行检查
         + 栈数据类型和操作码参数是否吻合(超出栈空间)
      + 符号引用验证:最后一步验证,发生在解析阶段
         + 常量池中描述类是否存在
         + 访问的方法或者字段是否存在且有足够的权限(保证可以执行解析操作)  
   2.准备:为类变量分配内存(到方法区)并设置类变量的默认初始值如int类型为0,引用类型为null;但是不会为实例变量分配(不带static修饰),实例变量会随对象一起分配到java堆.  
```
private static int a = 1;  
```
准备阶段 a = 0;  
```
private final static int a = 1;  
```
准备阶段 a = 1;  
初始化为ConstantValue所指向的值(编译后的初始化值),可以理解为在编译器就将结果放入了调用它的常量池当中;  
ConstantValue:通知虚拟机自动为final static属性赋值,而且只有final static修饰的时候才会触发ConstantValue;  
局限于基本数据类型和String,因为在常量池中只能引用到基本数据类型以及String.  

加载字节码文件的方式:  
   1. 从本地系统中直接加载;  
   2. 通过网络下载.class文件;  
   3. 从归档文件中加载.class文件(jar包,war包);  
   4. 从专有数据库中提取.class文件(jsp);  
   5. 将java源文件动态编译为.class文件,也就是运行时计算而成(动态代理);  
   6. 从加密文件中获取;  

要想加载字节码文件到内存当中,必须要先找到这个字节码文件,而且加载这个文件必须是一个流文件,所以第一步字节码文件要先变成一个字节流,然后可以通过他的名字找; 


#### 1.运行时数据区
#### 2.类加载机制
#### 3.字节码执行机制
#### 4.GC
#### 5.JVM内存监控与故障定位
#### 6.JVM调优